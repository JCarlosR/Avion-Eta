
; PICBASIC PRO(TM) Compiler 2.47, (c) 1998, 2006 microEngineering Labs, Inc. All Rights Reserved.  
PM_USED			EQU	1

	INCLUDE	"16F876.INC"


; Define statements.
#define		CODE_SIZE		 8
#define		OSC		 4
#define		LOADER_USED		 1   
#define		HSER_BAUD		 19200  
#define		LCD_DREG		 PORTB
#define		LCD_DBIT		 4
#define		LCD_RSREG		 PORTB
#define		LCD_RSBIT		 1
#define		LCD_EREG		 PORTB
#define		LCD_EBIT		 2
#define		LCD_BITS		 4
#define		LCD_LINES		 2
#define		LCD_COMMANDUS		 2000
#define		LCD_DATAUS		 50

RAM_START       		EQU	00020h
RAM_END         		EQU	001EFh
RAM_BANKS       		EQU	00004h
BANK0_START     		EQU	00020h
BANK0_END       		EQU	0007Fh
BANK1_START     		EQU	000A0h
BANK1_END       		EQU	000EFh
BANK2_START     		EQU	00110h
BANK2_END       		EQU	0016Fh
BANK3_START     		EQU	00190h
BANK3_END       		EQU	001EFh
EEPROM_START    		EQU	02100h
EEPROM_END      		EQU	021FFh

R0              		EQU	RAM_START + 000h
R1              		EQU	RAM_START + 002h
R2              		EQU	RAM_START + 004h
R3              		EQU	RAM_START + 006h
R4              		EQU	RAM_START + 008h
R5              		EQU	RAM_START + 00Ah
R6              		EQU	RAM_START + 00Ch
R7              		EQU	RAM_START + 00Eh
R8              		EQU	RAM_START + 010h
FLAGS           		EQU	RAM_START + 012h
GOP             		EQU	RAM_START + 013h
RM1             		EQU	RAM_START + 014h
RM2             		EQU	RAM_START + 015h
RR1             		EQU	RAM_START + 016h
RR2             		EQU	RAM_START + 017h
_PUNTAJE         		EQU	RAM_START + 018h
T1              		EQU	RAM_START + 01Ah
T2              		EQU	RAM_START + 01Ch
_C               		EQU	RAM_START + 01Eh
_ESCENARIO       		EQU	RAM_START + 01Fh
_I               		EQU	RAM_START + 020h
PB01            		EQU	RAM_START + 021h
_POS             		EQU	RAM_START + 022h
_Ticks           		EQU	RAM_START + 023h
_VEL             		EQU	RAM_START + 024h
_VIDAS           		EQU	RAM_START + 025h
_PORTL           		EQU	 PORTB
_PORTH           		EQU	 PORTC
_TRISL           		EQU	 TRISB
_TRISH           		EQU	 TRISC
#define _R_0             	 PB01, 002h
#define _AR0             	 PB01, 000h
#define _R_3             	 PB01, 003h
#define _AR3             	 PB01, 001h
#define _PORTC??0        	 PORTC, 000h
#define _PORTC??3        	 PORTC, 003h
#define _INTCON??2       	 INTCON, 002h
#define _PORTC??1        	 PORTC, 001h
#define _PORTC??2        	 PORTC, 002h
#define _INTCON??1       	 INTCON, 001h

; EEPROM data.
	ORG EEPROM_START

	ORG EEPROM_START + 000h
	DE	013h
	DE	017h
	DE	01Bh
	DE	01Dh
	DE	023h
	DE	024h
	DE	013h
	DE	018h
	DE	01Ah
	DE	01Eh
	DE	024h
	DE	026h
	DE	011h
	DE	016h
	DE	018h
	DE	01Ch
	DE	01Dh
	DE	023h
	DE	011h
	DE	013h
	DE	014h
	DE	01Ch
	DE	01Eh
	DE	021h
	ORG EEPROM_START + 018h
	DE	051h
	DE	055h
	DE	059h
	DE	05Fh
	DE	061h
	DE	066h
	DE	051h
	DE	055h
	DE	056h
	DE	05Ch
	DE	061h
	DE	062h
	DE	053h
	DE	054h
	DE	05Ah
	DE	05Fh
	DE	060h
	DE	065h
	DE	056h
	DE	058h
	DE	059h
	DE	063h
	DE	065h
	DE	066h

	INCLUDE	"AVION-~1.MAC"
	INCLUDE	"PBPPIC14.LIB"

	LCDOUT?C	0FEh
	LCDOUT?C	040h
	LCDOUT?C	002h
	LCDOUT?C	006h
	LCDOUT?C	012h
	LCDOUT?C	01Fh
	LCDOUT?C	012h
	LCDOUT?C	006h
	LCDOUT?C	002h
	LCDOUT?C	000h
	LCDOUT?C	000h
	LCDOUT?C	01Bh
	LCDOUT?C	00Eh
	LCDOUT?C	01Eh
	LCDOUT?C	00Eh
	LCDOUT?C	01Bh
	LCDOUT?C	000h
	LCDOUT?C	000h
	LCDOUT?C	00Ah
	LCDOUT?C	01Fh
	LCDOUT?C	00Eh
	LCDOUT?C	004h
	LCDOUT?C	00Eh
	LCDOUT?C	01Fh
	LCDOUT?C	00Ah
	LCDOUT?C	000h
	LCDOUT?C	00Eh
	LCDOUT?C	004h
	LCDOUT?C	004h
	LCDOUT?C	01Fh
	LCDOUT?C	00Eh
	LCDOUT?C	00Eh
	LCDOUT?C	01Bh
	LCDOUT?C	000h
	LCDOUT?C	004h
	LCDOUT?C	00Eh
	LCDOUT?C	00Ah
	LCDOUT?C	00Eh
	LCDOUT?C	004h
	LCDOUT?C	00Eh
	LCDOUT?C	01Fh
	LCDOUT?C	000h
	LCDOUT?C	01Fh
	LCDOUT?C	004h
	LCDOUT?C	004h
	LCDOUT?C	00Eh
	LCDOUT?C	015h
	LCDOUT?C	004h
	LCDOUT?C	00Eh
	LCDOUT?C	000h
	LCDOUT?C	011h
	LCDOUT?C	00Eh
	LCDOUT?C	01Fh
	LCDOUT?C	00Eh
	LCDOUT?C	004h
	LCDOUT?C	004h
	LCDOUT?C	004h
	LCDOUT?C	000h
	LCDOUT?C	008h
	LCDOUT?C	00Ch
	LCDOUT?C	009h
	LCDOUT?C	01Fh
	LCDOUT?C	009h
	LCDOUT?C	00Ch
	LCDOUT?C	008h
	LCDOUT?C	000h
	MOVE?CB	000h, _POS
	MOVE?CB	0FFh, _ESCENARIO
	GOSUB?L	_PINTAR_ESCENARIO
	MOVE?CB	01Eh, _VIDAS
	ONINT?LL	_ProcesarInterrupt, L00001
	ICALL?L	L00001
	MOVE?CB	055h, OPTION_REG
	ICALL?L	L00001
	MOVE?CB	0B0h, INTCON

	LABEL?L	_FuncPrincipal	
	ICALL?L	L00001
	MOVE?TT	_PORTC??0, _R_0
	ICALL?L	L00001
	MOVE?TT	_PORTC??3, _R_3
	ICALL?L	L00001
	CMPEQ?TCB	_AR3, 000h, T1
	CMPEQ?TCB	_R_3, 001h, T2
	LAND?BBW	T1, T2, T2
	CMPF?WL	T2, L00002
	ICALL?L	L00001
	ADD?BCB	_VEL, 001h, _VEL
	ICALL?L	L00001
	GOSUB?L	_MAS_VELOCIDAD
	ICALL?L	L00001
	LABEL?L	L00002	
	ICALL?L	L00001
	CMPEQ?TCB	_AR0, 000h, T1
	CMPEQ?TCB	_R_0, 001h, T2
	LAND?BBW	T1, T2, T2
	CMPF?WL	T2, L00004
	ICALL?L	L00001
	GOSUB?L	_RESETEO
	ICALL?L	L00001
	LABEL?L	L00004	
	ICALL?L	L00001
	CMPNE?BCL	_VIDAS, 000h, L00006
	GOSUB?L	_FINALIZAR
	LABEL?L	L00006	
	ICALL?L	L00001
	MOVE?TT	_R_0, _AR0
	ICALL?L	L00001
	MOVE?TT	_R_3, _AR3
	ICALL?L	L00001
	GOTO?L	_FuncPrincipal

	LABEL?L	_MAS_VELOCIDAD	
	ICALL?L	L00001
	CMPNE?BCL	_VEL, 004h, L00008
	MOVE?CB	000h, _VEL
	LABEL?L	L00008	
	ICALL?L	L00001
	SUB?CBB	055h, _VEL, OPTION_REG
	ICALL?L	L00001
	RETURN?	

	LABEL?L	_AVANCE	
	ICALL?L	L00001
	LCDOUT?C	0FEh
	ADD?CBW	080h, _POS, T1
	LCDOUT?W	T1
	ICALL?L	L00001
	LCDOUT?C	020h
	ICALL?L	L00001
	LCDOUT?C	0FEh
	LCDOUT?C	01Ch
	ICALL?L	L00001
	CMPEQ?BCB	_POS, 057h, T1
	CMPEQ?BCB	_POS, 017h, T2
	LOR?BBW	T1, T2, T2
	CMPF?WL	T2, L00010
	ICALL?L	L00001
	SUB?BCB	_POS, 017h, _POS
	ICALL?L	L00001
	GOSUB?L	_MOVERSE_ADELANTE
	ICALL?L	L00001
	GOTO?L	L00011
	LABEL?L	L00010	
	ICALL?L	L00001
	ADD?BCB	_POS, 001h, _POS
	ICALL?L	L00001
	LABEL?L	L00011	
	ICALL?L	L00001
	LCDOUT?C	0FEh
	ADD?CBW	080h, _POS, T1
	LCDOUT?W	T1
	LCDOUT?C	000h
	ICALL?L	L00001
	GOSUB?L	_VERIFICAR_COLISION
	ICALL?L	L00001
	ADD?WCW	_PUNTAJE, 001h, _PUNTAJE
	ICALL?L	L00001
	RETURN?	

	LABEL?L	_VERIFICAR_COLISION	
	ICALL?L	L00001
	CMPNE?BCL	_ESCENARIO, 000h, L00012
	ICALL?L	L00001
	MOVE?CB	003h, _ESCENARIO
	ICALL?L	L00001
	GOTO?L	L00013
	LABEL?L	L00012	
	ICALL?L	L00001
	SUB?BCB	_ESCENARIO, 001h, _ESCENARIO
	ICALL?L	L00001
	LABEL?L	L00013	
	ICALL?L	L00001
	MUL?BCB	_ESCENARIO, 006h, _I
	LABEL?L	L00014	
	MUL?BCW	_ESCENARIO, 006h, T1
	ADD?WCW	T1, 005h, T1
	CMPGT?BWL	_I, T1, L00015
	ICALL?L	L00001
	READ?BB	_I, _C
	ICALL?L	L00001
	CMPLE?BCL	_C, 018h, L00016
	ICALL?L	L00001
	SUB?BCB	_C, 018h, _C
	ICALL?L	L00001
	CMPNE?BBL	_C, _POS, L00018
	ICALL?L	L00001
	SUB?BCB	_VIDAS, 001h, _VIDAS
	ICALL?L	L00001
	ADD?BCB	_ESCENARIO, 001h, _ESCENARIO
	ICALL?L	L00001
	CMPNE?BCL	_ESCENARIO, 004h, L00020
	MOVE?CB	000h, _ESCENARIO
	LABEL?L	L00020	
	ICALL?L	L00001
	RETURN?	
	ICALL?L	L00001
	LABEL?L	L00018	
	ICALL?L	L00001
	LABEL?L	L00016	
	ICALL?L	L00001
	ADD?BCW	_I, 018h, T1
	READ?WB	T1, _C
	ICALL?L	L00001
	CMPLE?BCL	_C, 058h, L00022
	ICALL?L	L00001
	SUB?BCB	_C, 018h, _C
	ICALL?L	L00001
	CMPNE?BBL	_C, _POS, L00024
	ICALL?L	L00001
	SUB?BCB	_VIDAS, 001h, _VIDAS
	ICALL?L	L00001
	ADD?BCB	_ESCENARIO, 001h, _ESCENARIO
	ICALL?L	L00001
	CMPNE?BCL	_ESCENARIO, 004h, L00026
	MOVE?CB	000h, _ESCENARIO
	LABEL?L	L00026	
	ICALL?L	L00001
	RETURN?	
	ICALL?L	L00001
	LABEL?L	L00024	
	ICALL?L	L00001
	LABEL?L	L00022	
	ICALL?L	L00001
	NEXT?BCL	_I, 001h, L00014
	LABEL?L	L00015	
	ICALL?L	L00001
	ADD?BCB	_ESCENARIO, 001h, _ESCENARIO
	ICALL?L	L00001
	CMPNE?BCL	_ESCENARIO, 004h, L00028
	MOVE?CB	000h, _ESCENARIO
	LABEL?L	L00028	
	ICALL?L	L00001
	MUL?BCB	_ESCENARIO, 006h, _I
	LABEL?L	L00030	
	MUL?BCW	_ESCENARIO, 006h, T1
	ADD?WCW	T1, 005h, T1
	CMPGT?BWL	_I, T1, L00031
	ICALL?L	L00001
	READ?BB	_I, _C
	ICALL?L	L00001
	CMPNE?BBL	_C, _POS, L00032
	ICALL?L	L00001
	SUB?BCB	_VIDAS, 001h, _VIDAS
	ICALL?L	L00001
	RETURN?	
	ICALL?L	L00001
	LABEL?L	L00032	
	ICALL?L	L00001
	ADD?BCW	_I, 018h, T1
	READ?WB	T1, _C
	ICALL?L	L00001
	CMPNE?BBL	_C, _POS, L00034
	ICALL?L	L00001
	SUB?BCB	_VIDAS, 001h, _VIDAS
	ICALL?L	L00001
	RETURN?	
	ICALL?L	L00001
	LABEL?L	L00034	
	ICALL?L	L00001
	NEXT?BCL	_I, 001h, L00030
	LABEL?L	L00031	
	ICALL?L	L00001
	RETURN?	

	LABEL?L	_RESETEO	
	ICALL?L	L00001
	MOVE?CW	000h, _PUNTAJE
	ICALL?L	L00001
	MOVE?CB	014h, _VIDAS
	ICALL?L	L00001
	MOVE?CB	040h, _POS
	ICALL?L	L00001
	MOVE?CB	0FFh, _ESCENARIO
	ICALL?L	L00001
	GOSUB?L	_PINTAR_ESCENARIO
	ICALL?L	L00001
	MOVE?CB	0B0h, INTCON
	ICALL?L	L00001
	MOVE?CB	000h, _Ticks
	ICALL?L	L00001
	RETURN?	

	LABEL?L	_FINALIZAR	
	ICALL?L	L00001
	LCDOUT?C	0FEh
	LCDOUT?C	001h
	ICALL?L	L00001
	LCDOUT?C	0FEh
	LCDOUT?C	0C0h
	ICALL?L	L00001
	LCDOUT?C	050h
	LCDOUT?C	055h
	LCDOUT?C	04Eh
	LCDOUT?C	054h
	LCDOUT?C	041h
	LCDOUT?C	04Ah
	LCDOUT?C	045h
	LCDOUT?C	03Ah
	LCDOUT?C	020h
	LCDOUTCOUNT?C	000h
	LCDOUTNUM?W	_PUNTAJE
	LCDOUTDEC?	
	ICALL?L	L00001
	MOVE?CB	0FFh, _VIDAS
	ICALL?L	L00001
	MOVE?CB	000h, INTCON
	ICALL?L	L00001
	RETURN?	

	LABEL?L	_PINTAR_ESCENARIO	
	ICALL?L	L00001
	MOVE?CB	000h, INTCON
	ICALL?L	L00001
	LCDOUT?C	0FEh
	LCDOUT?C	001h
	ICALL?L	L00001
	CMPNE?BCL	_ESCENARIO, 0FFh, L00036
	ICALL?L	L00001
	LCDOUT?C	0FEh
	LCDOUT?C	080h
	ICALL?L	L00001
	LCDOUT?C	020h
	LCDOUT?C	020h
	LCDOUT?C	020h
	LCDOUT?C	020h
	LCDOUT?C	005h
	LCDOUT?C	020h
	LCDOUT?C	007h
	LCDOUT?C	020h
	LCDOUT?C	020h
	LCDOUT?C	003h
	ICALL?L	L00001
	LCDOUT?C	0FEh
	LCDOUT?C	0C0h
	ICALL?L	L00001
	LCDOUT?C	020h
	LCDOUT?C	003h
	LCDOUT?C	020h
	LCDOUT?C	020h
	LCDOUT?C	020h
	LCDOUT?C	020h
	LCDOUT?C	020h
	LCDOUT?C	020h
	LCDOUT?C	020h
	LCDOUT?C	020h
	LCDOUT?C	020h
	LCDOUT?C	006h
	LCDOUT?C	020h
	LCDOUT?C	001h
	LCDOUT?C	002h
	ICALL?L	L00001
	MOVE?CB	000h, _I
	LABEL?L	L00038	
	CMPGT?BCL	_I, 005h, L00039
	ICALL?L	L00001
	READ?BB	_I, _C
	ICALL?L	L00001
	LCDOUT?C	0FEh
	ADD?CBW	080h, _C, T1
	LCDOUT?W	T1
	ICALL?L	L00001
	MOD?BCW	_C, 007h, T1
	ADD?WCW	T1, 001h, T1
	LCDOUT?W	T1
	ICALL?L	L00001
	ADD?BCW	_I, 018h, T1
	READ?WB	T1, _C
	ICALL?L	L00001
	LCDOUT?C	0FEh
	ADD?CBW	080h, _C, T1
	LCDOUT?W	T1
	ICALL?L	L00001
	MOD?BCW	_C, 007h, T1
	ADD?WCW	T1, 001h, T1
	LCDOUT?W	T1
	ICALL?L	L00001
	NEXT?BCL	_I, 001h, L00038
	LABEL?L	L00039	
	ICALL?L	L00001
	MOVE?CB	000h, _ESCENARIO
	ICALL?L	L00001
	GOTO?L	L00037
	LABEL?L	L00036	
	ICALL?L	L00001
	MUL?BCB	_ESCENARIO, 006h, _I
	LABEL?L	L00040	
	MUL?BCW	_ESCENARIO, 006h, T1
	ADD?WCW	T1, 005h, T1
	CMPGT?BWL	_I, T1, L00041
	ICALL?L	L00001
	READ?BB	_I, _C
	ICALL?L	L00001
	CMPLE?BCL	_C, 017h, L00042
	ICALL?L	L00001
	LCDOUT?C	0FEh
	ADD?CBW	080h, _C, T1
	SUB?WCW	T1, 018h, T1
	LCDOUT?W	T1
	ICALL?L	L00001
	MOD?BCW	_C, 007h, T1
	ADD?WCW	T1, 001h, T1
	LCDOUT?W	T1
	ICALL?L	L00001
	LABEL?L	L00042	
	ICALL?L	L00001
	ADD?BCW	_I, 018h, T1
	READ?WB	T1, _C
	ICALL?L	L00001
	CMPLE?BCL	_C, 057h, L00044
	ICALL?L	L00001
	LCDOUT?C	0FEh
	ADD?CBW	080h, _C, T1
	SUB?WCW	T1, 018h, T1
	LCDOUT?W	T1
	ICALL?L	L00001
	MOD?BCW	_C, 007h, T1
	ADD?WCW	T1, 001h, T1
	LCDOUT?W	T1
	ICALL?L	L00001
	LABEL?L	L00044	
	ICALL?L	L00001
	NEXT?BCL	_I, 001h, L00040
	LABEL?L	L00041	
	ICALL?L	L00001
	ADD?BCB	_ESCENARIO, 001h, _ESCENARIO
	ICALL?L	L00001
	CMPNE?BCL	_ESCENARIO, 004h, L00046
	MOVE?CB	000h, _ESCENARIO
	LABEL?L	L00046	
	ICALL?L	L00001
	MUL?BCB	_ESCENARIO, 006h, _I
	LABEL?L	L00048	
	MUL?BCW	_ESCENARIO, 006h, T1
	ADD?WCW	T1, 005h, T1
	CMPGT?BWL	_I, T1, L00049
	ICALL?L	L00001
	READ?BB	_I, _C
	ICALL?L	L00001
	LCDOUT?C	0FEh
	ADD?CBW	080h, _C, T1
	LCDOUT?W	T1
	ICALL?L	L00001
	MOD?BCW	_C, 007h, T1
	ADD?WCW	T1, 001h, T1
	LCDOUT?W	T1
	ICALL?L	L00001
	ADD?BCW	_I, 018h, T1
	READ?WB	T1, _C
	ICALL?L	L00001
	LCDOUT?C	0FEh
	ADD?CBW	080h, _C, T1
	LCDOUT?W	T1
	ICALL?L	L00001
	MOD?BCW	_C, 007h, T1
	ADD?WCW	T1, 001h, T1
	LCDOUT?W	T1
	ICALL?L	L00001
	NEXT?BCL	_I, 001h, L00048
	LABEL?L	L00049	
	ICALL?L	L00001
	LABEL?L	L00037	
	ICALL?L	L00001
	MOVE?CB	0B0h, INTCON
	ICALL?L	L00001
	RETURN?	

	LABEL?L	_MOVERSE_ADELANTE	
	ICALL?L	L00001
	LCDOUT?C	0FEh
	LCDOUT?C	002h
	ICALL?L	L00001
	GOSUB?L	_PINTAR_ESCENARIO
	ICALL?L	L00001
	RETURN?	
	DISABLE?	

	LABEL?L	_ProcesarInterrupt	
	CMPNE?TCL	_INTCON??2, 001h, L00050
	ADD?BCB	_Ticks, 001h, _Ticks
	CMPLE?BCL	_Ticks, 014h, L00052
	MOVE?CB	000h, _Ticks
	GOSUB?L	_AVANCE
	LABEL?L	L00052	
	MOVE?CT	000h, _INTCON??2
	GOTO?L	L00051
	LABEL?L	L00050	
	CMPNE?TCL	_PORTC??1, 001h, L00054
	CMPLE?BCL	_POS, 040h, L00056
	SUB?BCB	_POS, 040h, _POS
	LABEL?L	L00056	
	GOTO?L	L00055
	LABEL?L	L00054	
	CMPEQ?TCB	_PORTC??2, 001h, T1
	CMPLT?BCB	_POS, 040h, T2
	LAND?BBW	T1, T2, T2
	CMPF?WL	T2, L00058
	ADD?BCB	_POS, 040h, _POS
	LABEL?L	L00058	
	LABEL?L	L00055	
	MOVE?CT	000h, _INTCON??1
	LABEL?L	L00051	
	RESUME?	
	ENABLE?	

	END
